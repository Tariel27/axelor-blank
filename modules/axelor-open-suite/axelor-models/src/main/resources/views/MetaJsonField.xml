<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">

  <form name="json-field-form" id="custom-json-field-form" title="Custom field"
    model="com.axelor.meta.db.MetaJsonField">
    <panel title="Overview">
      <field name="name" x-pattern="^[a-zA-Z]+([A-Z][a-z]+)+$"
        onChange="action-studio-meta-json-model-name-onchange-record,action-studio-meta-json-field-record-name"/>
      <field name="type" selection="json.field.type.for-analytic"
        onChange="action-json-field-record-set-visible-in-grid"/>
      <field name="title"/>
      <field name="defaultValue"/>
      <field name="help" colSpan="12"/>
      <field name="model" widget="ref-text"
        x-domain="self.metaFields.json = true AND self.fullName NOT LIKE 'com.axelor.meta.db%'"
        x-target-name="fullName" x-target="com.axelor.meta.db.MetaModel"
        onChange="action-record-set-attrs-to-metafield"/>
      <field if="__config__.app.getApp('bpm')?.getEnableAppBuilder()" name="appBuilder"
        form-view="app-builder-form" grid-view="app-builder-grid"/>
      <spacer if="__config__.app.getApp('bpm')?.getEnableAppBuilder()"
        name="appBuilderSpacer"/>
      <field name="isAutoGenerated" showIf="type == 'string'" x-direction="horizontal"
        onChange="action-record-change-readonly-auto" widget="boolean-switch"/>
    </panel>
    <panel title="Options" hideIf="isAutoGenerated == true">
      <panel itemSpan="12">
        <field name="enumType" showIf="type === 'enum'" widget="ref-text"
          x-target="com.axelor.meta.db.MetaEnum" x-target-name="name"/>
        <field name="selection" showIf="type !== 'enum'" widget="ref-text"
          x-target="com.axelor.meta.db.MetaSelect" x-target-search="title"/>
      </panel>
      <field name="widget" widget="ref-text" x-domain="self.type = :type"
        x-target="com.axelor.studio.db.FieldWidget"/>
      <field name="minSize" title="Min" showIf="type.match('string|integer|decimal')"/>
      <field name="maxSize" title="Max" showIf="type.match('string|integer|decimal')"/>
      <field name="precision" showIf="type === 'decimal'"/>
      <field name="scale" showIf="type === 'decimal'"/>
      <field name="regex" showIf="type === 'string'" colSpan="12"/>
      <panel itemSpan="12">
        <field name="targetModel" showIf="type.match('^(one|many)-to-')" widget="ref-text"
          x-target="com.axelor.meta.db.MetaModel" x-target-name="fullName"/>
        <field name="targetJsonModel" showIf="type.match('^json-')"
          title="Target custom model" canEdit="false" canView="false"/>
      </panel>
      <field name="domain" showIf="type.match('-to-')"/>
      <field name="gridView" showIf="type.match('^(one|many)-to-')" widget="ref-text"
        x-target="com.axelor.meta.db.MetaView" x-target-name="name"
        x-domain="self.model = :targetModel AND self.type = 'grid'"/>
      <field name="formView" showIf="type.match('^(one|many)-to-')" widget="ref-text"
        x-target="com.axelor.meta.db.MetaView" x-target-name="name"
        x-domain="self.model = :targetModel AND self.type = 'form'"/>
    </panel>
    <panel title="Sequence information" showIf="isAutoGenerated">
      <field name="prefix" requiredIf="isAutoGenerated"/>
      <field name="suffix" requiredIf="isAutoGenerated"/>
      <field name="initialValue" requiredIf="isAutoGenerated"/>
      <field name="sequenceIncrement" requiredIf="isAutoGenerated"/>
      <field name="padding" requiredIf="isAutoGenerated"/>
    </panel>
    <panel title="Options" sidebar="true" itemSpan="12">
      <field name="required" widget="inline-checkbox"/>
      <field name="readonly" widget="inline-checkbox"/>
      <field name="nameField" widget="inline-checkbox" showIf="type === 'string'"/>
      <field name="hidden" widget="inline-checkbox"/>
      <field name="visibleInGrid" widget="inline-checkbox"/>
    </panel>
  </form>

  <action-record name="action-record-set-attrs-to-metafield"
    model="com.axelor.meta.db.MetaJsonField">
    <field name="modelField" expr="eval: 'attrs'"/>
  </action-record>

  <form name="json-field-form-for-analytic" title="Custom fields"
    model="com.axelor.meta.db.MetaJsonField"
    onNew="action-json-field-defaults,action-json-field-defaults-custom">
    <panel title="Overview">
      <field name="name" x-pattern="^[a-zA-Z]+([A-Z][a-z]+)+$"
        onChange="action-studio-meta-json-model-name-onchange-record,action-studio-meta-json-field-record-name"/>
      <field name="type" selection="json.field.type.for-analytic"
        onChange="action-attrs-change-is-search-field"/>
      <field name="title"/>
      <field name="defaultValue"/>
      <field name="help" colSpan="12"/>
      <field name="sequence" x-bind="{{columnSequence}}" hidden="true"/>
      <field name="columnSequence"/>
      <field name="isAutoGenerated" showIf="type == 'string' &amp;&amp; isSearchField != true"
        x-direction="horizontal" onChange="action-record-change-readonly-auto"
        widget="boolean-switch"/>
      <field name="isSearchField" showIf="type == 'string' &amp;&amp; isAutoGenerated != true"
        x-direction="horizontal"
        onChange="action-record-change-readonly-search,action-group-get-fields-by-model"
        widget="boolean-switch"/>
    </panel>

    <panel title="Options" hideIf="isAutoGenerated == true || isSearchField == true">
      <panel itemSpan="12">
        <field name="enumType" showIf="type === 'enum'" widget="ref-text"
          x-target="com.axelor.meta.db.MetaEnum" x-target-name="name"/>
        <field name="selection" showIf="type !== 'enum'" widget="ref-text"
          x-target="com.axelor.meta.db.MetaSelect" x-target-search="title"/>
      </panel>
      <field name="widget" widget="ref-text" x-domain="self.type = :type"
        x-target="com.axelor.studio.db.FieldWidget"/>
      <field name="minSize" title="Min" showIf="type.match('string|integer|decimal')"/>
      <field name="maxSize" title="Max" showIf="type.match('string|integer|decimal')"/>
      <field name="precision" showIf="type === 'decimal'"/>
      <field name="scale" showIf="type === 'decimal'"/>
      <field name="regex" showIf="type === 'string'" colSpan="12"/>

      <panel itemSpan="12">
        <field name="targetModel" requiredIf="type.match('^(one|many)-to-')"
          showIf="type.match('^(one|many)-to-')" widget="ref-text"
          x-target="com.axelor.meta.db.MetaModel" x-target-name="fullName"/>
        <field name="targetJsonModel" requiredIf="type.match('^json-')"
          showIf="type.match('^json-')" title="Target custom model" canEdit="false" canView="false"/>
      </panel>

      <field name="domain" showIf="type.match('-to-')"/>
      <field name="gridView" showIf="type.match('^(one|many)-to-')" widget="ref-text"
        x-target="com.axelor.meta.db.MetaView" x-target-name="name"
        x-domain="self.model = :targetModel AND self.type = 'grid'"/>
      <field name="formView" showIf="type.match('^(one|many)-to-')" widget="ref-text"
        x-target="com.axelor.meta.db.MetaView" x-target-name="name"
        x-domain="self.model = :targetModel AND self.type = 'form'"/>
    </panel>

    <panel title="Sequence information" showIf="isAutoGenerated">
      <field name="prefix" requiredIf="isAutoGenerated"/>
      <field name="suffix" requiredIf="isAutoGenerated"/>
      <field name="initialValue" requiredIf="isAutoGenerated"/>
      <field name="sequenceIncrement" requiredIf="isAutoGenerated"/>
      <field name="padding" requiredIf="isAutoGenerated"/>
    </panel>

    <panel title="Options" sidebar="true" itemSpan="12">
      <field name="required" widget="inline-checkbox"/>
      <field name="readonly" widget="inline-checkbox"/>
      <field name="nameField" widget="inline-checkbox" showIf="type === 'string'"/>
      <field name="hidden" widget="inline-checkbox"/>
      <field name="visibleInGrid" widget="inline-checkbox"/>
    </panel>

    <panel showIf="isSearchField == true" hideIf="isAutoGenerated == true">
      <panel title="Search options">
        <field name="searchFields"
          requiredIf="isSearchField == true &amp;&amp; isAutoGenerated == false" readonly="true"
          hidden="true"/>
        <field name="templateField" readonly="true" hidden="true"/>
      </panel>
      <panel colSpan="12">
        <field name="checkBoxField" readonly="true" colSpan="12"
          title="Select fields, that you want to merge">
          <viewer>
            <![CDATA[
                <div ng-controller="MetaJsonFieldController">
                  <label ng-repeat="item in array track by $index">
                    <input type="checkbox" ng-change="checkField(item)" ng-model="myModel" style="margin-right: 5px"/>{{item}}
                  </label>
                </div>
              ]]>
          </viewer>
        </field>
      </panel>
    </panel>
  </form>

  <action-record name="action-json-field-defaults-custom"
    model="com.axelor.meta.db.MetaJsonField">
    <field name="visibleInGrid" expr="true"/>
    <field name="columnSequence"
      expr="eval: __parent__.fields != null ? __parent__.fields.size + 1 : 0"/>
  </action-record>

  <action-record name="action-record-change-readonly-auto"
    model="com.axelor.meta.db.MetaJsonField">
    <field name="readonly" expr="eval: isAutoGenerated"/>
  </action-record>

  <action-record name="action-record-change-readonly-search"
    model="com.axelor.meta.db.MetaJsonField">
    <field name="readonly" expr="eval: isSearchField"/>
  </action-record>

  <action-method name="action-method-get-fields-by-model">
    <call class="com.axelor.studio.web.MetaJsonFieldController" method="getFieldsForSearch"/>
  </action-method>

  <action-group name="action-group-get-fields-by-model">
    <action if="isSearchField == true" name="action-method-get-fields-by-model"/>
  </action-group>

  <action-attrs name="action-attrs-change-is-search-field">
    <attribute if="type != 'string'" for="isSearchField" name="value:set"
      expr="eval: false"/>
  </action-attrs>
</object-views>